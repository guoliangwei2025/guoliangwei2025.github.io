{"title":"LangChain","uid":"0d43d0f6b5521a4904839727c6757d0b","slug":"LangChain","date":"2025-08-25T02:23:50.000Z","updated":"2025-08-26T08:06:10.839Z","comments":true,"path":"api/articles/LangChain.json","keywords":"AIã€Python","cover":[],"content":"<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>æœ¬ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»LangChainåŸºç¡€è¯­æ³•ï¼ŒRAGåŸç†ï¼Œä»¥åŠä½¿ç”¨LangChainå®ç°ç®€æ˜“çš„RAGç³»ç»Ÿï¼Œè¯¦ç»†çš„RAGä¼˜åŒ–ä»¥åŠç±»å‹åœ¨å¦å¤–çš„æ–‡ç« è¿›è¡Œä»‹ç»</p></blockquote>\n<h1 id=\"1-LangChain-ç®€ä»‹\"><a href=\"#1-LangChain-ç®€ä»‹\" class=\"headerlink\" title=\"1.LangChain ç®€ä»‹\"></a>1.LangChain ç®€ä»‹</h1><p>Langchainsæ˜¯ç”¨äºå¼€å‘å¤§æ¨¡å‹é©±åŠ¨çš„æ¡†æ¶ï¼Œå€ŸåŠ©LangChainå¯ä»¥è½»æ¾æ­å»ºåŸºäºLLMçš„ç›¸å…³åº”ç”¨ï¼Œæ¯”å¦‚RAGç³»ç»Ÿ</p>\n<p>æ­¤æ¡†æ¶åŒ…å«ä»¥ä¸‹éƒ¨åˆ†ï¼š</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">langchain-<span class=\"attr\">core</span>: åŸºç¡€æŠ½è±¡å’Œ<span class=\"title class_\">LangChain</span>è¡¨è¾¾å¼ (<span class=\"variable constant_\">LCEL</span>)</span><br><span class=\"line\">langchain-<span class=\"attr\">community</span>: ç¬¬ä¸‰æ–¹é›†æˆï¼Œç¬¬ä¸‰æ–¹ç›¸å…³çš„åŒ…</span><br><span class=\"line\"><span class=\"attr\">langchain</span>: ç»„æˆåº”ç”¨ç¨‹åºè®¤çŸ¥æ¶æ„çš„é“¾ã€ä»£ç†å’Œæ£€ç´¢ç­–ç•¥ã€‚</span><br><span class=\"line\"><span class=\"title class_\">LangGraph</span>: é€šè¿‡å°†æ­¥éª¤å»ºæ¨¡ä¸ºå›¾ä¸­çš„è¾¹å’ŒèŠ‚ç‚¹ï¼Œæ„å»ºå¼ºå¤§ä¸”æœ‰çŠ¶æ€çš„å¤šå‚ä¸è€…åº”ç”¨ç¨‹åºã€‚ä¸<span class=\"title class_\">LangChain</span>æ— ç¼é›†æˆï¼Œä½†ä¹Ÿå¯ä»¥å•ç‹¬ä½¿ç”¨</span><br><span class=\"line\"><span class=\"title class_\">LangServe</span>: å°†<span class=\"title class_\">LangChain</span>é“¾éƒ¨ç½²ä¸º<span class=\"variable constant_\">REST</span> <span class=\"variable constant_\">API</span></span><br><span class=\"line\"><span class=\"title class_\">LangSmith</span>: ä¸€ä¸ªå¼€å‘è€…å¹³å°ï¼Œè®©æ‚¨è°ƒè¯•ã€æµ‹è¯•ã€è¯„ä¼°å’Œç›‘æ§<span class=\"variable constant_\">LLM</span>åº”ç”¨ç¨‹åº</span><br></pre></td></tr></table></figure>\n\n\n\n<img src=\"/post/LangChain/langchain_stack_062024.svg\" class=\"\" title=\"Diagram outlining the hierarchical organization of the LangChain framework, displaying the interconnected parts across multiple layers.\">\n\n\n\n<h1 id=\"2-LangChain-åŸºç¡€\"><a href=\"#2-LangChain-åŸºç¡€\" class=\"headerlink\" title=\"2.LangChain åŸºç¡€\"></a>2.LangChain åŸºç¡€</h1><blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>LangChainæ˜¯ä¸ºå¤§æ¨¡å‹åº”ç”¨è€Œç”Ÿçš„æ¡†æ¶ï¼Œç»“åˆå¤§æ¨¡å‹åº”ç”¨é€»è¾‘ä¸Šï¼Œåˆ†ä¸ºè¾“å…¥ã€æ¨¡å‹å¤„ç†ã€è¾“å‡ºä¸‰ä¸ªç¯èŠ‚ã€‚é€šè¿‡æ„å»ºæç¤ºè¯å·¥ç¨‹ï¼Œä½œä¸ºä¸Šä¸‹æ–‡ç»™å¤§æ¨¡å‹ï¼Œç„¶åé€šè¿‡ç»“æœè§£æå™¨è§£æç›¸åº”æ ¼å¼çš„è¾“å‡º</p></blockquote>\n<h3 id=\"LCELè¡¨è¾¾å¼\"><a href=\"#LCELè¡¨è¾¾å¼\" class=\"headerlink\" title=\"LCELè¡¨è¾¾å¼\"></a>LCELè¡¨è¾¾å¼</h3><p>åŸºäºLangChainæ¡†æ¶ç¼–å†™å¤§æ¨¡å‹åº”ç”¨çš„è¿‡ç¨‹å°±åƒå’ç§¯æœ¨ï¼Œå…¶ä¸­çš„ç§¯æœ¨å°±æ˜¯Promptsï¼ŒLLMså’Œå„OutputParserç­‰ã€‚å¦‚ä½•å°†è¿™äº›ç§¯æœ¨ç»„ç»‡èµ·æ¥ï¼Œé™¤äº†ä½¿ç”¨åŸºæœ¬Pythonè¯­æ³•è°ƒç”¨å¯¹åº”ç±»çš„æ–¹æ³•ï¼Œä¸€ç§æ›´çµæ´»çš„æ–¹æ³•å°±æ˜¯ä½¿ç”¨ä½äºLangChain-Coreå±‚ä¸­çš„LCELï¼ˆLangChain Expression Languageï¼‰(ä½¿ç”¨ç®¡é“ç¬¦æ¥è¿›è¡Œæ‹¼æ¥)</p>\n<h3 id=\"Runnableæ¥å£\"><a href=\"#Runnableæ¥å£\" class=\"headerlink\" title=\"Runnableæ¥å£\"></a>Runnableæ¥å£</h3><p>LCELçš„åŸºç¡€æ˜¯Runnableæ¥å£ã€‚é€šè¿‡å®ç°Runnableæ¥å£ï¼ŒLCELå®šä¹‰äº†ä¸€ç»„å…·æœ‰é€šç”¨è°ƒç”¨æ–¹å¼çš„æ–¹æ³•é›†ã€‚</p>\n<p>Runnableæœ‰ä¸€ç³»åˆ—çš„å­ç±»ï¼Œæ¯”å¦‚PromptTemplateã€LLMå’ŒStrOutputParserï¼ˆè¿˜æœ‰æ›´å¤šï¼‰ï¼Œè¿™äº›ç»„ä»¶å­ç±»éƒ½é—´æ¥ç»§æ‰¿è‡ªRunnable(ç»§æ‰¿è‡ªRunnableSequenceï¼Œè€Œåè€…åˆç»§æ‰¿è‡ªRunnable) é€šè¿‡ ç®¡é“ç¬¦â€|â€å‰åä¸¤ä¸ªç»„ä»¶åˆæˆä¸€ä¸ªRunnableçš„å­å­™ç±»RunnableSequenceå¯¹è±¡è¿”å›ï¼Œä»è€Œè¾¾åˆ°ä¸²èµ·æ¥å½¢æˆé“¾(chain)çš„ç›®çš„ã€‚</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>Runnableçš„__or__()æ–¹æ³•é‡æ–°å®šä¹‰äº†â€|â€è¯­æ³•ï¼Œæ‰€ä»¥åŸºäºLCELçš„chainå°±èƒ½é€šè¿‡æˆ–(ä¹Ÿç±»ä¼¼shellä¸­çš„ç®¡é“)æ“ä½œç¬¦å·â€|â€ä¸²èµ·æ¥ã€‚è¿™ä¹Ÿå°±æ˜¯å‰é¢æåˆ°çš„â€œchain &#x3D; prompt | llm | output_parserâ€è¿™è¡Œä»£ç è™½ç„¶çœ‹ä¸Šå»è·Ÿæ™®é€šPythonä¸ä¸€æ ·ï¼Œä½†å®ƒæ˜¯åˆæ³•çš„ï¼ŒåŸå› å°±åœ¨è¿™é‡Œ</p></blockquote>\n<h1 id=\"3-LangChainå®ç°RAG\"><a href=\"#3-LangChainå®ç°RAG\" class=\"headerlink\" title=\"3.LangChainå®ç°RAG\"></a>3.LangChainå®ç°RAG</h1><blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>RAGçš„å‡ºç°æ˜¯ä¸ºäº†åœ¨ä¸€å®šç¨‹åº¦ä¸Šç¼“è§£å¤§æ¨¡å‹çš„å¹»è§‰é—®é¢˜ï¼Œå› ä¸ºå¤§æ¨¡å‹çš„è¾“å‡ºæ˜¯åŸºäºæ•°å­¦æ¦‚ç‡çš„è¾“å‡ºé¢„æµ‹ã€ä¸”ä¿¡æ¯ä¸å…·æœ‰å®æ•ˆæ€§ã€ç¼ºä¹ç›¸å…³é¢†åŸŸçš„ä¸“ä¸šçŸ¥è¯†ï¼Œä¸‹é¢ä½¿ç”¨LangChainçš„é“¾å¼è°ƒç”¨å®ç°ç®€å•çš„RAGã€‚</p></blockquote>\n<p>åŸºç¡€RAGç³»ç»Ÿï¼Œæµç¨‹å¦‚ä¸‹ï¼š</p>\n<ol>\n<li>æ–‡æ¡£åˆ‡åˆ†</li>\n<li>å‘é‡åµŒå…¥</li>\n<li>æ„å»ºæç¤ºè¯</li>\n<li>å®šä¹‰å¤§æ¨¡å‹æœåŠ¡</li>\n<li>æ£€ç´¢ç›¸å…³ç‰‡æ®µä½œä¸ºå¤§æ¨¡å‹ä¸Šä¸‹æ–‡</li>\n<li>ç»“æœè§£æå™¨å¯¹å¤§æ¨¡å‹ç»“æœè¿›è¡Œè§£æ</li>\n</ol>\n<img src=\"/post/LangChain/1749692995102-11eee3df-61bf-45ed-9bda-aae631c77571.png\" class=\"\" title=\"image.png\">\n\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#å®Œæ•´çš„rag  </span></span><br><span class=\"line\"><span class=\"keyword\">from</span> langchain_core.output_parsers  <span class=\"keyword\">import</span> StrOutputParser</span><br><span class=\"line\">query = <span class=\"string\">&quot;åœ¨çº¿æ”¯ä»˜å–æ¶ˆè®¢å•åé’±æ€ä¹ˆè¿”è¿˜&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">from</span> langchain_community.embeddings <span class=\"keyword\">import</span> DashScopeEmbeddings</span><br><span class=\"line\"><span class=\"keyword\">from</span> config.load_key <span class=\"keyword\">import</span> load_key</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> <span class=\"keyword\">not</span> os.environ.get(<span class=\"string\">&quot;DASHSCOPE_API_KEY&quot;</span>):</span><br><span class=\"line\">    os.environ[<span class=\"string\">&quot;DASHSCOPE_API_KEY&quot;</span>] = load_key(<span class=\"string\">&quot;LANGSMITH_API_KEY&quot;</span>)</span><br><span class=\"line\">embedding_model = DashScopeEmbeddings(model=<span class=\"string\">&quot;text-embedding-v1&quot;</span>)</span><br><span class=\"line\">redis_url = <span class=\"string\">&quot;redis://localhost:6379&quot;</span></span><br><span class=\"line\">config = RedisConfig(</span><br><span class=\"line\">    index_name=<span class=\"string\">&quot;meituan-index&quot;</span>,   <span class=\"comment\"># ç´¢å¼•åï¼Œå¯¹åº”ä¹‹å‰æ„å»ºçš„çŸ¥è¯†åº“ç´¢å¼•</span></span><br><span class=\"line\">    redis_url=redis_url,          <span class=\"comment\"># Redis è¿æ¥åœ°å€</span></span><br><span class=\"line\">)</span><br><span class=\"line\">vector_store = RedisVectorStore(embedding_model, config=config)</span><br><span class=\"line\">retriever = vector_store.as_retriever()</span><br><span class=\"line\"><span class=\"comment\">#å®šä¹‰å¤§æ¨¡å‹</span></span><br><span class=\"line\"><span class=\"keyword\">from</span> langchain_openai <span class=\"keyword\">import</span>  ChatOpenAI</span><br><span class=\"line\">llm = ChatOpenAI(</span><br><span class=\"line\">    model = <span class=\"string\">&quot;deepseek-v3&quot;</span>,</span><br><span class=\"line\">    base_url =<span class=\"string\">&quot;https://dashscope.aliyuncs.com/compatible-mode/v1 &quot;</span>,</span><br><span class=\"line\">    openai_key = load_key(<span class=\"string\">&quot;LANGSMITH_API_KEY&quot;</span>),</span><br><span class=\"line\">)</span><br><span class=\"line\"> <span class=\"comment\">#å®šä¹‰æç¤ºæ¨¡æ¿</span></span><br><span class=\"line\"><span class=\"keyword\">from</span> langchain_core.prompts <span class=\"keyword\">import</span>  ChatPromptTemplate</span><br><span class=\"line\">prompt_template = ChatPromptTemplate.from_messages([</span><br><span class=\"line\">    (<span class=\"string\">&quot;user&quot;</span>, <span class=\"string\">&quot;ä½ æ˜¯ä¸€ä¸ªç­”ç–‘æœºå™¨äººï¼Œä½ çš„ä»»åŠ¡æ˜¯æ ¹æ®ä¸‹è¿°ç»™å®šçš„å·²çŸ¥ä¿¡æ¯å›ç­”ç”¨æˆ·é—®é¢˜ã€‚\\n&quot;</span></span><br><span class=\"line\">             <span class=\"string\">&quot;å·²çŸ¥ä¿¡æ¯ï¼š&#123;context&#125;\\n&quot;</span></span><br><span class=\"line\">             <span class=\"string\">&quot;ç”¨æˆ·é—®é¢˜ï¼š&#123;question&#125;\\n\\n&quot;</span></span><br><span class=\"line\">             <span class=\"string\">&quot;å¦‚æœå·²çŸ¥ä¿¡æ¯ä¸å«ç”¨æˆ·é—®é¢˜çš„ç­”æ¡ˆï¼Œæˆ–è€…å·²çŸ¥ä¿¡æ¯ä¸è¶³ä»¥å›ç­”ç”¨æˆ·é—®é¢˜ï¼Œè¯·ç›´æ¥å›å¤â€œæˆ‘æ— æ³•å›ç­”æ‚¨é—®é¢˜â€ã€‚\\n&quot;</span></span><br><span class=\"line\">             <span class=\"string\">&quot;è¯·ä¸è¦è¾“å‡ºå·²çŸ¥ä¿¡æ¯ä¸­ä¸åŒ…å«çš„ä¿¡æ¯æˆ–ç­”æ¡ˆã€‚\\n&quot;</span></span><br><span class=\"line\">             <span class=\"string\">&quot;è¯·ç”¨ä¸­æ–‡å›ç­”ç”¨æˆ·é—®é¢˜ã€‚&quot;</span>)</span><br><span class=\"line\">  ])</span><br><span class=\"line\"><span class=\"comment\">#æ”¶é›†documentå†…å®¹</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">collect_document_content</span>(<span class=\"params\">segments</span>):</span><br><span class=\"line\">    text = []</span><br><span class=\"line\">    <span class=\"keyword\">for</span> segment <span class=\"keyword\">in</span> segments:</span><br><span class=\"line\">        text.append(segment.page_content)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> text</span><br><span class=\"line\"><span class=\"keyword\">from</span> operator <span class=\"keyword\">import</span> itemgetter</span><br><span class=\"line\">chain = (&#123;</span><br><span class=\"line\">     <span class=\"string\">&quot;question&quot;</span>: query,</span><br><span class=\"line\">    <span class=\"string\">&quot;context&quot;</span>: itemgetter(<span class=\"string\">&quot;question&quot;</span>)|retriever |collect_document_content,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">| prompt_template</span><br><span class=\"line\">| llm</span><br><span class=\"line\">| StrOutputParser()</span><br><span class=\"line\">)</span><br><span class=\"line\">response = chain.invoke(&#123;<span class=\"string\">&quot;question&quot;</span>: query&#125;)</span><br><span class=\"line\">  </span><br></pre></td></tr></table></figure>\n\n<h1 id=\"4-ç›¸å…³èµ„æ–™\"><a href=\"#4-ç›¸å…³èµ„æ–™\" class=\"headerlink\" title=\"4.ç›¸å…³èµ„æ–™\"></a>4.ç›¸å…³èµ„æ–™</h1><p><a href=\"https://www.yuque.com/goodnote/llm-dev\">å¤§æ¨¡å‹åº”ç”¨å¼€å‘å­¦ä¹ èµ„æ–™</a></p>\n<p><a href=\"https://www.langchain.com.cn/\">LangChainä¸­æ–‡æ–‡æ¡£</a></p>\n<p><a href=\"https://blog.csdn.net/stingfire/category_12701200.html\">CSDNåšå®¢</a></p>\n","text":" æœ¬ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»LangChainåŸºç¡€è¯­æ³•ï¼ŒRAGåŸç†ï¼Œä»¥åŠä½¿ç”¨LangChainå®ç°ç®€æ˜“çš„RAGç³»ç»Ÿï¼Œè¯¦ç»†çš„RAGä¼˜åŒ–ä»¥åŠç±»å‹åœ¨å¦å¤–çš„æ–‡ç« è¿›è¡Œä»‹ç» 1.La...","permalink":"/post/LangChain","photos":[],"count_time":{"symbolsCount":"3.3k","symbolsTime":"3 mins."},"categories":[{"name":"Langchain","slug":"Langchain","count":1,"path":"api/categories/Langchain.json"}],"tags":[{"name":"AI","slug":"AI","count":2,"path":"api/tags/AI.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#1-LangChain-%E7%AE%80%E4%BB%8B\"><span class=\"toc-text\">1.LangChain ç®€ä»‹</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#2-LangChain-%E5%9F%BA%E7%A1%80\"><span class=\"toc-text\">2.LangChain åŸºç¡€</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#LCEL%E8%A1%A8%E8%BE%BE%E5%BC%8F\"><span class=\"toc-text\">LCELè¡¨è¾¾å¼</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#Runnable%E6%8E%A5%E5%8F%A3\"><span class=\"toc-text\">Runnableæ¥å£</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#3-LangChain%E5%AE%9E%E7%8E%B0RAG\"><span class=\"toc-text\">3.LangChainå®ç°RAG</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#4-%E7%9B%B8%E5%85%B3%E8%B5%84%E6%96%99\"><span class=\"toc-text\">4.ç›¸å…³èµ„æ–™</span></a></li></ol>","author":{"name":"GuoLiangWei","slug":"blog-author","avatar":"/img/logo.jpg","link":"/","description":"<span style='font-size:30px;background:linear-gradient(90deg,#00c6ff,#0072ff);-webkit-background-clip:text;-webkit-text-fill-color:transparent;'>å¿ƒç…§ä¸å®£</span><span style='font-size:30px;'>ğŸ’•</span>","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"github":{"icon":"https://cdn.jsdelivr.net/npm/simple-icons@11/icons/github.svg","link":"https://github.com/guoliangwei2025"},"qq":{"icon":"https://cdn.jsdelivr.net/npm/simple-icons@11/icons/tencentqq.svg","link":"https://wpa.qq.com/msgrd?v=3&uin=2691160140&site=qq&menu=yes"}}}},"mapped":true,"hidden":false,"prev_post":{"title":"AIåº”ç”¨å¼€å‘","uid":"91542ceb6cfe1ea979ed37f536b865f2","slug":"AIåº”ç”¨å¼€å‘","date":"2025-08-27T01:54:27.000Z","updated":"2025-08-27T01:54:27.379Z","comments":true,"path":"api/articles/AIåº”ç”¨å¼€å‘.json","keywords":"AIã€Python","cover":null,"text":"","permalink":"/post/AIåº”ç”¨å¼€å‘","photos":[],"count_time":{"symbolsCount":0,"symbolsTime":"1 mins."},"categories":[],"tags":[],"author":{"name":"GuoLiangWei","slug":"blog-author","avatar":"/img/logo.jpg","link":"/","description":"<span style='font-size:30px;background:linear-gradient(90deg,#00c6ff,#0072ff);-webkit-background-clip:text;-webkit-text-fill-color:transparent;'>å¿ƒç…§ä¸å®£</span><span style='font-size:30px;'>ğŸ’•</span>","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"github":{"icon":"https://cdn.jsdelivr.net/npm/simple-icons@11/icons/github.svg","link":"https://github.com/guoliangwei2025"},"qq":{"icon":"https://cdn.jsdelivr.net/npm/simple-icons@11/icons/tencentqq.svg","link":"https://wpa.qq.com/msgrd?v=3&uin=2691160140&site=qq&menu=yes"}}}}},"next_post":{"title":"hexoåšå®¢æ­å»ºæ•™ç¨‹","uid":"7a072923df6718781f31165a7507480d","slug":"hexoåšå®¢æ­å»ºæ•™ç¨‹","date":"2025-08-24T05:44:09.000Z","updated":"2025-08-28T05:57:42.676Z","comments":true,"path":"api/articles/hexoåšå®¢æ­å»ºæ•™ç¨‹.json","keywords":"AIã€Python","cover":[],"text":" åˆè¡·ï¼š æˆ‘è®°å¾—åœ¨åˆšä¸Šå¤§ä¸‰é‚£ä¼šå„¿ï¼Œæƒ³æŠŠè‡ªå·±å­¦çš„ä¸€äº›ä¸œè¥¿è®°å½•åˆ°å¾®ä¿¡å…¬ä¼—å·ä¸Šã€‚åˆšå¼€å§‹åšæŒäº†å‡ å¤©ï¼Œä½†æ˜¯åæ¥æ”¾å¼ƒäº†ï¼Œå› ä¸ºå¤§éƒ¨åˆ†æ˜¯Copyï¼Œä¹Ÿç¼ºå°‘è‡ªå·±çš„æ€è€ƒã€‚ ç»è¿‡æœ€è¿‘çš„...","permalink":"/post/hexoåšå®¢æ­å»ºæ•™ç¨‹","photos":[],"count_time":{"symbolsCount":"3.1k","symbolsTime":"3 mins."},"categories":[{"name":"åšå®¢æ­å»ºæ•™ç¨‹","slug":"åšå®¢æ­å»ºæ•™ç¨‹","count":1,"path":"api/categories/åšå®¢æ­å»ºæ•™ç¨‹.json"}],"tags":[{"name":"åšå®¢æ­å»ºæ•™ç¨‹","slug":"åšå®¢æ­å»ºæ•™ç¨‹","count":1,"path":"api/tags/åšå®¢æ­å»ºæ•™ç¨‹.json"}],"author":{"name":"GuoLiangWei","slug":"blog-author","avatar":"/img/logo.jpg","link":"/","description":"<span style='font-size:30px;background:linear-gradient(90deg,#00c6ff,#0072ff);-webkit-background-clip:text;-webkit-text-fill-color:transparent;'>å¿ƒç…§ä¸å®£</span><span style='font-size:30px;'>ğŸ’•</span>","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"github":{"icon":"https://cdn.jsdelivr.net/npm/simple-icons@11/icons/github.svg","link":"https://github.com/guoliangwei2025"},"qq":{"icon":"https://cdn.jsdelivr.net/npm/simple-icons@11/icons/tencentqq.svg","link":"https://wpa.qq.com/msgrd?v=3&uin=2691160140&site=qq&menu=yes"}}}}}}